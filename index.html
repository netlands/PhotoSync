<!DOCTYPE html>
<html lang="en">

<head>
  <title>Simple Photo Sync</title>
  <script src='https://code.jquery.com/jquery-1.9.1.min.js'></script>
  <script src="https://cdn.jsdelivr.net/npm/before-after-slider@1.0.0/dist/slider.bundle.js"></script>
  <!-- compare: https://github.com/VincentTV/before-after-slider -->
  <link rel="stylesheet" type="text/css"
    href="https://cdn.jsdelivr.net/gh/cotton123236/zoomist@latest/dist/zoomist.min.css" />
  <script src="https://cdn.jsdelivr.net/gh/cotton123236/zoomist@latest/dist/zoomist.min.js"></script>
  <!-- zoom: https://github.com/cotton123236/zoomist -->
  <!-- grid: https://stackoverflow.com/questions/32556463/overlay-grid-on-responsive-image -->
  <!-- crosshair: https://codepen.io/michaelsboost/pen/DEQzoN -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
  <!-- https://fonts.google.com/icons?selected=Material+Icons&icon.set=Material+Icons -->
  <script src="https://cdn.jsdelivr.net/npm/socket.io-client@4.5.0/dist/socket.io.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.10/dist/clipboard.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
  <!-- https://lokeshdhakar.com/projects/color-thief -->
  <!-- https://stackoverflow.com/questions/3032856/is-it-possible-to-set-the-stacking-order-of-pseudo-elements-below-their-parent-e/9072467#9072467-->
  <script>
    var socket = io();

    var sourceFile, targetFile;
    var firstFile = true;

    var maxItemLen = 20;

    var showgrid = true;
    var showCompare = false;
    var zoomActive = false;
    var showCrosshair = true;
    var showFileinfo = true;
    var hideGridOnMouseOver = true;
    var previousReference = true;

    const colorThief = new ColorThief();

    socket.on('disconnect', function () {
      // Houston, we have a problem ...
      console.log("Lost connection to watcher");
      $('#file-info').html('<span class="dot warning"></span>Connection Lost. Check server and device');
    })


    socket.on('connect', function () {
      console.log("Connected to watcher");
      $('#file-info').html('<span class="dot"></span>Connected to server');
      socket.emit('getconfig', "hi there!")
    });

    socket.on('new photo', function (msg) {
      // console.log(msg);
      if (previousReference) {
        document.getElementById("reference").src = document.getElementById("photo").src;
      }
      document.getElementById("photo").src = msg;
      if (showCompare) {
        destroyCompare();
      }
      if (zoomActive) {
        closeZoom();
      }
      $('.copy-file').removeClass("hide-menu-item");
      $('.filename').removeClass("hide-menu-item");
      $("#triage").removeClass("done");
    });
    socket.on('new data', function (msg) {
      // console.log(msg);
      $('#exif').removeClass("hide-menu-item")
      document.getElementById("photo").title = msg.filename;
      $("#filename-menu-item").attr("title", "Click to copy filename\n " + msg.filename);
      sourceFile = msg.source;
      targetFile = msg.target;
      $('#file-info').text(msg.filename);
      if ((msg.ISO == null) || (msg.ISO == "")) {
        //
      } else {
        if (msg.hasOwnProperty('ISO')) {
          $('#file-info').text("SS " + msg.SS + ", F " + msg.F + ", ISO " + msg.ISO + ", " + msg.EV +
            " EV, flash " +
            msg
            .flash);
          $('#file-info').show();
          document.getElementById("container").setAttribute('data-content', msg.filename);
          document.getElementById("filename").innerText = msg.filename;
          document.getElementById("source").innerText = msg.source.substring(0, msg.source.lastIndexOf(
            "\\"));
          document.getElementById("target").innerText = msg.target.substring(0, msg.target.lastIndexOf(
            "\\"));
          document.getElementById("ISO").innerText = msg.ISO;
          document.getElementById("F").innerText = msg.F;
          document.getElementById("SS").innerText = msg.SS;
          document.getElementById("EV").innerText = msg.EV;
          if (msg.flash.includes("not")) {
            document.getElementById("flash").innerText = "flash_off";
          } else {
            document.getElementById("flash").innerText = "flash_on";
          }
        }
      }
      if ((msg.ISO == null) || (msg.ISO == "")) {
        $('#exif').addClass("hide-menu-item")
      } else {
        $('#exif').removeClass("hide-menu-item")
      }

      if (quicksort && firstFile) {
        $("#triage").removeClass("hide");
        firstFile = false;
      }

      // reset quicksort for each file
      $('#star').show();
      $('#discard').show();
      $('#keep').show();
      $('#review').show();

      checkColors();

    });

    function deleteFromTarget() {
      socket.emit('delete target', document.getElementById("container").getAttribute('data-content'));
    }

    function deleteFromCamera() {
      let confirmAction = confirm(
        "WARNING! Are you sure you want to delete the original photo? This action cannot be undone.");
      if (confirmAction) {
        // alert("Source file deleted");
        socket.emit('delete camera', document.getElementById("container").getAttribute('data-content'));
      } else {}
    }

    function copyFile() {
      socket.emit('copy source', sourceFile);
    }


    function quickSort(action) {
      socket.emit('sort', action);
      $("#triage").addClass("done");
      switch (action) {
        case "keep":
          $('#discard').hide();
          $('#star').hide();
          $('#review').hide();
          break;
        case "discard":
          $('#keep').hide();
          $('#star').hide();
          $('#review').hide();
          break;
        case "star":
          $('#keep').hide();
          $('#discard').hide();
          $('#review').hide();
        case "review":
          $('#keep').hide();
          $('#discard').hide();
          $('#star').hide();
          break;
        default:
      }
    }




    var targetfolder, sourcefolder, extenstion, autocopy, quicksort, showgrid

    socket.on('config', function (msg) {
      // console.log(msg);
      let config = msg;
      targetfolder = config.target;
      sourcefolder = config.source;
      $('#file-info').html('<span class="dot"></span>Watching folder ' + sourcefolder);
      extenstion = config.extension;
      autocopy = config.settings.autocopy;
      showgrid = config.settings.showgrid;
      quicksort = config.settings.quicksort;
      previousReference = config.settings.previousreference;
      document.getElementById("source").innerText = msg.source.substring(0, msg.source.lastIndexOf("\\"));
      document.getElementById("target").innerText = msg.target.substring(0, msg.target.lastIndexOf("\\"));
      $("#source-menu-item").attr("title", "Click to copy source folder\n " + msg.source.substring(0, msg.source
        .lastIndexOf("\\")));
      $("#target-menu-item").attr("title", "Click to copy target folder\n " + msg.target.substring(0, msg.target
        .lastIndexOf("\\")));
      if (autocopy) {
        console.log("autocopy on");
        $('.copy-file').addClass("hide-menu-item");
      } else {
        console.log("autocopy off");
        $('.copy-file').removeClass("hide-menu-item");
        $('.delete-copy').addClass("hide-menu-item");
      }

      if (showgrid) {
        console.log("grid on")
        $("#image").addClass("grid");
        document.getElementById("grid_toggle").innerText = "grid_off";
      } else {
        console.log("grid off")
        $("#image").removeClass("grid");
        document.getElementById("grid_toggle").innerText = "grid_on";
      }

      if (quicksort) {
        console.log("quicksort on")
        $('.copy-file').addClass("hide-menu-item");
        // $('.quick-sort').addClass("hide-menu-item");
        // $("#triage").removeClass("hide"); // hide untill first picture loaded
        $(".delete-copy").addClass("hide-menu-item");
      } else {
        console.log("quicksort off")
        $("#triage").addClass("hide");
        $('.quick-sort').removeClass("hide-menu-item");


      }

    });



    $(document).ready(function () {
      console.log("DOM ready")

      // get configuration
      // socket.emit('getconfig', "hi there!")


      // Setup our variables
      var cH = $('#crosshair-h'),
        cV = $('#crosshair-v');

      $(this).on('mousemove touchmove', function (e) {
        var x = e.pageX - 1;
        var y = e.pageY - 1;
        cH.css('top', e.pageY);
        cV.css('left', e.pageX);

        /* $('#file-info').css({
            top: e.pageY + 'px',
            left: e.pageX + 'px'
        }, 800); */
        // $('#file-info').text( "X: " + x + "px, Y: " + y + "px");
        e.stopPropagation();
      });

      $("#container").mouseleave(function () {
        $(".hair").hide();
        $("#file-info").hide();
        if (hideGridOnMouseOver && showgrid) {
          $("#image").addClass("grid");
        }
      });
      $("#container").mouseenter(function () {
        if (showCrosshair) {
          $(".hair").show();
          if (hideGridOnMouseOver && showgrid) {
            $("#image").removeClass("grid");
          }
        }
        if (!($('#file-info').text() == "")) {
          if (showFileinfo) {
            $('#file-info').show();
          }
        }
      });

      new ClipboardJS('.clip');

    });

    window.addEventListener('load', function () {
      console.log("Page content loaded")
      if (showgrid) {
        $("#image").addClass("grid");
      }

      checkColors();

      const divDelete = document.querySelector('#delete_original');
      divDelete.addEventListener("click",
        function (e) {
          if (e.ctrlKey) {
            deleteFromCamera();
          }
        },
        false);


      var canvas = document.getElementById("guides");
      var context = canvas.getContext("2d");

      // http://jsfiddle.net/PgKEt/2/
      canvas.addEventListener("click", function (event) {
        const shift = event.getModifierState("Shift");
        const ctrl = event.getModifierState("Control");
        //const alt = event.getModifierState("Alt");
        if (ctrl && shift) {
          context.clearRect(0, 0, canvas.width, canvas.height);
        } else if (ctrl && !(shift)) {
          canvas.width = canvas.offsetWidth;
          canvas.height = canvas.offsetHeight;
          var x = event.pageX - canvas.offsetLeft;
          var y = event.pageY - canvas.offsetTop;
          context.clearRect(0, 0, canvas.width, canvas.height);
          context.beginPath();
          context.moveTo(0, y - 4); // offset crosshair
          context.lineTo(3000, y);
          context.moveTo(x - 2, 0); // offset crosshair
          context.lineTo(x, 3000);
          context.strokeStyle = "blue";
          context.stroke();
          context.closePath();
        }
      });



    })


    function checkColors() {
      const img = document.querySelector('img#photo');
      var mainColor = colorThief.getColor(img);
      if (lightOrDark(rgbToHex(mainColor[0], mainColor[1], mainColor[2])) == "dark") {
        console.log("dark");
        $(".hair").addClass("light")
      } else {
        console.log("light");
        $(".hair").removeClass("light")
      };
    }


    function componentToHex(c) {
      var hex = c.toString(16);
      return hex.length == 1 ? "0" + hex : hex;
    }

    function rgbToHex(r, g, b) {
      return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
    }

    //rgbToHex(102, 51, 153); // #663399

    // https://codepen.io/andreaswik/pen/YjJqpK
    function lightOrDark(color) {

      // Variables for red, green, blue values
      var r, g, b, hsp;

      // Check the format of the color, HEX or RGB?
      if (color.match(/^rgb/)) {

        // If RGB --> store the red, green, blue values in separate variables
        color = color.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/);

        r = color[1];
        g = color[2];
        b = color[3];
      } else {

        // If hex --> Convert it to RGB: http://gist.github.com/983661
        color = +("0x" + color.slice(1).replace(
          color.length < 5 && /./g, '$&$&'));

        r = color >> 16;
        g = color >> 8 & 255;
        b = color & 255;
      }

      // HSP (Highly Sensitive Poo) equation from http://alienryderflex.com/hsp.html
      hsp = Math.sqrt(
        0.299 * (r * r) +
        0.587 * (g * g) +
        0.114 * (b * b)
      );

      // Using the HSP value, determine whether the color is light or dark
      if (hsp > 127.5) {

        return 'light';
      } else {

        return 'dark';
      }
    }
  </script>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    img#photo {
      max-width: 100%;
      max-height: 100vh;
      display: block;
      /* remove extra space below image */
    }

    #container {
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      position: relative;
      display: grid;
      width: fit-content;
      height: fit-content;
      border: 1px solid black;
    }

    #reference {
      display: none;
      z-index: 10;
    }


    #guides {
      cursor: default;
      width: 100%;
      height: 100%;
      position: absolute;
    }

    #image {
      width: fit-content;
      height: fit-content;
    }

    #zoom {
      position: absolute;
      cursor: zoom-in;
    }

    #reference {
      display: none;
    }

    .grid {
      display: inline-block;
      position: relative;
      vertical-align: top;
    }

    .grid::before,
    .grid::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(to right, #ccc 1px, transparent 1px);
      background-size: 10%;
    }

    .grid::before {
      box-shadow: inset 0px 0px 0 1px #ccc;
    }

    .grid::after {
      transform: rotate(90deg);
    }

    .slider-container .slider-wrap .slider-btn {
      width: 1px;
    }

    .slider-container .slider-wrap .slider-btn:hover {
      background: rgba(0, 0, 0, 0.5);
      width: 8px;
    }

    .slider-container .slider-wrap .slider-btn::after {
      background-color: rgb(0 0 0 / 0%);
      content: '';
      box-shadow: none;
    }

    #crosshair-h {
      z-index: 100;
      width: 100%;
    }

    #crosshair-v {
      z-index: 100;
      height: 100%;
    }

    .hair {
      position: fixed;
      top: 0;
      left: 0;
      margin-top: -3px;
      margin-left: -2px;
      background: transparent;
      border-top: 1px dotted #000;
      border-left: 1px dotted #000;
      pointer-events: none;
      z-index: 2;
    }

    .hair.light {
      border-top: 1px dotted #fff;
      border-left: 1px dotted #fff;
    }

    .hide {
      display: none;
    }

    #file-info {
      display: none;
      position: absolute;
      bottom: 0;
      right: 0;
      padding: 10px;
      margin: 10px;
      font: 14px arial;
      color: #fff;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 24px;
      z-index: 9;
    }

    #file-info:hover {
      top: 0;
      left: 0;
      width: fit-content;
      height: fit-content;
    }

    /* Group same frames together */
    @keyframes blink {

      0%,
      100% {
        opacity: 0;
      }

      /* more concise! */
      50% {
        opacity: 1;
      }
    }

    .dot {
      animation: blink 1s infinite;
      float: left;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: greenyellow;
      margin-right: 6px;
    }

    .dot.warning {
      background: red;
    }

    #triage {
      z-index: 10;
      position: absolute;
      bottom: 0;
      left: 0;
      margin: 10px;
      background: rgba(0, 0, 0, 0);
    }

    #triage {
      position: absolute;
      z-index: 1;
    }

    #triage .material-icons {
      position: relative;
      display: inline-block;
      font-size: 50px;
      cursor: pointer;
      margin-right: 10px;
      margin-top: 10px;
      transition: all .2s ease-in-out;
    }

    #triage .material-icons:hover {
      transform: scale(1.2);
    }

    div#discard::after {
      content: ' ';
      top: 16px;
      left: 8px;
      position: absolute;
      width: 34px;
      height: 22px;
      background: #f6b3ad;
      z-index: -1;
    }


    div#review::after {
      content: ' ';
      top: 16px;
      left: 8px;
      position: absolute;
      width: 34px;
      height: 22px;
      background: #c9f0f8;
      z-index: -1;
    }

    div#star::after {
      content: ' ';
      top: 16px;
      left: 8px;
      position: absolute;
      width: 34px;
      height: 22px;
      background: #feebb3;
      z-index: -1;
    }

    #triage #discard,
    .discard {
      color: #ee685c;
    }

    #triage #keep,
    .keep {
      color: #34a853;
    }

    #triage #review,
    .review {
      color: #4ecde6;
    }

    #triage #star,
    .star {
      color: #fbbc04;
    }

    /* #669df6 */

    #triage.done {
      /* opacity: 0.5; */
      filter: grayscale(50%);
      pointer-events: none;
    }

    #context-menu {
      position: fixed;
      z-index: 10000;
      width: 220px;
      background: #999999;
      border-radius: 5px;
      transform: scale(0);
      transform-origin: top left;
    }

    #context-menu.active {
      transform: scale(1);
      transition: transform 200ms ease-in-out;
    }

    #context-menu .item {
      padding: 8px 10px;
      font-size: 18px;
      font-family: Calibri, sans-serif;
      color: #eee;
      cursor: pointer;
    }

    #context-menu .item:hover {
      background: #454545;
    }

    #context-menu .item.warning:hover {
      background: #454545;
      color: rgb(255, 0, 0);
    }

    #context-menu .item i {
      display: inline-block;
      margin-right: 5px;
    }

    #context-menu hr {
      margin: 2px 4px;
      border: 1px solid #999999;
      border-color: #999999;
    }

    .hide-menu-item {
      display: none;
    }

    .show-menu-item {
      display: block;
    }

    .material-icons {
      display: inline-flex;
      vertical-align: top;
      margin-right: 4px;
      font-size: 24px;
    }

    #context-menu .item#exif div {
      font-size: 16px;
      padding-bottom: 8px;
    }

    .item#exif .material-icons {
      font-size: 20px;
    }

    .debug {
      display: none;
    }


    .truncate {
      display: inline-block;
      max-width: 160px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }


    .close-button {
      position: absolute;
      top: 0;
      right: 0;
      margin-top: 10px;
      margin-right: 10px;
      cursor: pointer;
    }

    .close-button .material-icons {
      font-size: 30px;
      color: #747474;
      display: inline-block;
      border: 0px solid white;
      border-radius: 50%;
      background: rgba(184, 184, 184, 0.507);
      width: 34px;
      height: 34px;
      text-align: center;
      line-height: 34px;
    }

    /* ----------- */
    .gridlines {
      display: none;
      position: absolute;
      background-color: #ccc;
    }
  </style>
</head>

<body>
  <div id="context-menu">
    <div class="item copy-file" onclick="copyFile();">
      <span class="material-icons">file_copy</span> Copy Photo
    </div>
    <hr class="copy-file" />
    <div class="item delete-copy" onclick="deleteFromTarget();">
      <span class="material-icons">image</span> Delete Copy
    </div>
    <div class="item warning hide-menu-item" id="delete_original" title="Ctrl-click to delete">
      <span class="material-icons">sd_card</span> Delete Original
    </div>
    <hr />
    <div class="item" onclick="toggleGrid();">
      <span id="grid_toggle" class="material-icons">grid_off</span> Grid on/off
    </div>
    <div class="item" onclick="toggleCrosshair();">
      <span id="grid_crosshair" class="material-icons">add</span> Crosshair on/off
    </div>
    <div class="item" onclick="toggleZoom();">
      <span id="zoom_toggle" class="material-icons">zoom_in</span> Zoom View on/off
    </div>
    <div class="item" onclick="toggleCompare();">
      <span id="zoom_compare" class="material-icons">compare</span> Compare View on/off
    </div>
    <div class="item quick-sort" onclick="toggleQuickSort();">
      <span id="quick_sort" class="material-icons">category</span> Show/hide Quick Sort
    </div>
    <div class="item quick-sort" onclick="toggleFileinfo();">
      <span id="file_info" class="material-icons">text_snippet</span> Show/hide Info
    </div>
    <hr />
    <div class="item clip hide-menu-item filename" id="filename-menu-item" data-clipboard-target="#filename"
      title="Click to copy filename">
      <span class="material-icons">description</span>
      <div class="truncate" id="filename">Filename</div>
    </div>
    <div class="item clip" id="source-menu-item" data-clipboard-target="#source" title="Click to copy source folder">
      <span class="material-icons">photo_camera</span>
      <div class="truncate" id="source">Source Folder</div>
    </div>
    <div class="item clip" id="target-menu-item" data-clipboard-target="#target" title="Click to copy target folder">
      <span class="material-icons">desktop_windows</span>
      <div class="truncate" id="target">Target Folder</div>
    </div>
    <hr />
    <div class="item hide-menu-item" id="exif">
      <div><span class="material-icons">camera</span>F <span id="F"></span>
        <span class="material-icons">shutter_speed</span>SS <span id="SS"></span></div>
      <div><span class="material-icons">camera_roll</span>ISO <span id="ISO"></span>
        <span class="material-icons">iso</span><span id="EV"></span> EV
        <span id="flash" class="material-icons">flash_on</span></div>
    </div>
    <div class="item" title="Show help" onclick="showHelp();">
      <span class="material-icons">help_outline</span> <span id="target">Help</span>
    </div>
    <hr />
  </div>
  <div id="crosshair-h" class="hair"></div>
  <div id="crosshair-v" class="hair"></div>
  <div id="container" ondrop="dropHandler(event);" ondragover="dragOverHandler(event);">
    <canvas id="guides"></canvas>
    <div id="triage" class="hide">
      <div id="keep" onClick="quickSort('keep')" title="Keep" class="material-icons keep">folder</div>
      <div id="star" onClick="quickSort('star')" title="Star" class="material-icons star">folder_special</div>
      <div id="review" onClick="quickSort('review')" title="Review" class="material-icons review">rule_folder</div>
      <div id="discard" onClick="quickSort('discard')" title="Discard" class="material-icons discard">folder_delete
      </div>
    </div>
    <span id="file-info">Drag and drop an image file or connect a device.</span>
    <div id="image">
      <img id="photo"
        src="data:image/webp;base64,UklGRn4cAABXRUJQVlA4WAoAAAAIAAAA5wMA5wMAVlA4IIAbAACwKAGdASroA+gDPh0MhEICETcAYDielu/HyZ5etQzP0Q/mf4jeY/9B/n347/2P/texP4R8o/Pvxd/sf/M/0nBBf2/od/EPqt9P/sP67/2r/p/774z/qX5EebfxY/Xfyy+AL8U/iP9j/sP65f2//pf77j0AAfkP8w/wf+C/vv+Y/s/7J+wP+3/0D9evdb6tf8X+q/AB/G/5b/d/7h+1X9t///1H/gP8B4qfgHsBfx7+d/4P+3ftX/iP//9rX8H/rv7t+8X+S9sv5N/bv9J/mf3J/zf///An+NfzT/B/2z/L/8X/Af/7/tfbx7Af3X9ir9aP+OBaaVlIu5mpJGsWLFixYsWLFixYsWLFixYsWLFivh3ISsJ6jTi/yzUDhswEYrHpimXZ1GjOgWxtSLh3EWEoC/w94kF5kXczUkjWLFixYsWK+Cp96KDKxAHJCb5lACqg9xCFPzOIB+2x/3KIQkZgbJBMrJsD8XUtSdo6MSgZI1HZXAssoaArGd6pCmlG9Sh+09kv2cn9ulXQqjdzNSSNYsWLFixYsV8XitAjoHyMrOkjyDMIRRRBzJng73SyZshGQuVfx1BFYEvFbdk539BFu0q4yvkQisGwdH0i7makkaxYsWLFivjYSYmWKY800dG05TZeBQXqGGWgvAx8CyhVF5cl1jJ8aETM0sXw4hVf6RbtCGpnYZt1kQlBIu5mpJGsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYnLH2me4hTPZLcRkMGX6ssJlqW5AupJXNDwfCoH+/ba6l7qFxvL2xC6liDVch5wg1fWcK1BeFyaWDGr53FDM6pZL/lLQSxrbSLuZqSRrFixYsWLFixXxfDs8saFvr2irc6qCHInJTg+vYKWdI6YziT0AVCrgSsr6CLHBmEJHgOGoQOa8GbjhClFb+kXczUkjWLFixYsWLFfFjF5fhFyo16MzTwBwHFE6vlQWwTJ3cuTEdBJX4dxcrWZVQNRyQGUh5MTAGwfOzjwUQuvyY8HiW4eJpWUi7makkaxYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFfFK8BYsJBWMwWL3qH4cBS7LNunCBdeL9Q2hTF0276Vx4yvV8UGbpCsEoIfbG/v/SLuZqSRrFixYsWLFixYsWK+BvR980rTJIHGICuAXlEFVG02OCrrA6bNuJMcljEICRnwF2HiWmsaczixuVOZqSRrFixYsWLFixYsWLFixYnGza+BxtaKdiFGjdpQIUVb/QEiH5XO+Onb0VKsaC2MLdtmIUaK+aovDKrNgi1UFSSNYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYnAAA/v/8RMAA5gstkA6Rd1PByijdgUGXGEqMaikFTCRV80hBUCzIUX2C4+p8kfSkz1NE5o1L0S2BiJtoXugr7lqogcqDnvmxD2DxJKPXwQXJkM4SIWhcjvSUV03w/e1neP4E51QZNTEsCPk1Z7Q7Ggwjkpd1Vy4xm1mWoN/HR90Zrvp4LdPZUHZ2WmpyrUeP6nKbcnJq4fGSblB7/rrORQIASB63kICX/14AcUsxuUiSyT4ytAT47lwt7BJGQ+NgsLg5qlJVvuzHWDceTZr92DRWfCCYp8VRdA0z7UXJd5bVJEZOShCnydkz3bJaf6dPQO1b0OxnSw/jhGCbufoOLGWQofZ9Tcp8eWhNXs6DAb5gZ9XhEUuJSG63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"
        alt="photo" />
      <img id="reference"
        src="data:image/webp;base64,UklGRkIOAABXRUJQVlA4WAoAAAAIAAAA5wMA5wMAVlA4IEQNAADwCwGdASroA+gDPh0IhEIBCQBgOJ6W78fJnl6+iPsBPHpcLb4v/uuk7QeHP45+B37D+oD8T/h34SfsN7B/gHxL8N/Bf9Yv8J3f5/oEFmnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOlQAKxzpdYAM0CjpeoAEhoVel1gy+RqMdKgBuL+AAr8IhkeRYsWLFixYsWLFiviuTpZ1mC99gKmp7F8Vs+cRnRKhk2Iqdm0uLsy8Qor39nwuuJmSp3LbJDe06G4uIv2JxbWjyxAqvLdF1UEXZTOAWv79+/fv379+/fv3qfICi24qDOtjMraZmTtuL+D8ZghFo8TdnddMqhMttasFlAkBLk5xG1qrWrCABxyXZ8Ci6fQT0oo79DTp06dOnTp06dOnIUoqgXk7bt7ollWI/JvcxPJVxPAnd8Oq+AQvsMTrj8Si9gfhCm0Gb6ILX1Axjq+isyfFycKQPqQxiIg7SF3taelr+/fv379+/fv379+/fv379+/fv379+/fv379+/fv379+/fv379+/fv379+/fv379+/fv379+/fv379+/fv379+/fv379+/fv379+/fv379+/fv379+/fv379+/fv3qYruSZS+CNz1ZUAOEIVTPwiOkPNQswrrAAAEtgP4XpkB8t6gP8CUiRmuThSAAAisfZByLFixYsWLFixYsWLFixOO/9oCPrsalrAnHicV+JytTzFL/1DYESBRePvYjpax2AA45FcozAdQpvbV6bzN/o62jyLFixYsWLFixORFW8F09zfUvNyt2/GWCPNemU+zAAB4HhyLkLyRXwGWTPSrJSlafvhPsAURhgFnixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYr4AFkPUv8hcXidwCgHJTSWll1Ow8hLYAk+lv78VM9HYHiyZmT99wjraPIsWLFixYsWLFixYsWLFfFoylA3UkPYviBLQVbCCzKGXQpMBM8HIB7MX1BI0wJxN/o62jyLFixYsWLFixYsWLE4AE5HEAOORse4RzR5UCVkNoc4WZ1nhk7JJPsrxQCSEpZRN/o62jyLFixYsWLFixYsWJ0KgfPQVuNRRP4U9zfVqMCom/0dbR5FixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFi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"
        alt="reference" />
    </div>
  </div>
  <div id="help" class="modal">
    <style>
      /* The Modal (background) */
      .modal {
        display: none;
        /* Hidden by default */
        position: fixed;
        /* Stay in place */
        z-index: 10;
        /* Sit on top */
        padding-top: 50px;
        /* Location of the box */
        left: 0;
        top: 0;
        width: 100%;
        /* Full width */
        height: 100%;
        /* Full height */
        overflow: auto;
        /* Enable scroll if needed */
        background-color: rgb(0, 0, 0);
        /* Fallback color */
        background-color: rgba(0, 0, 0, 0.4);
        /* Black w/ opacity */
      }

      /* Modal Content */
      .modal-content {
        background-color: #fefefe;
        margin: auto;
        padding: 40px;
        padding-top: 20px;
        border: 1px solid #888;
        width: 80%;
        font-size: 18px;
        font-family: Calibri, sans-serif;
      }

      /* The Close Button */
      .close {
        color: #aaaaaa;
        float: right;
        font-size: 30px;
        font-weight: bold;
      }

      .close:hover,
      .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
      }

      .modal-content ul {
        list-style-type: none;
        padding: 0;
        margin: 0;
      }

      .modal-content ul li {
        padding-bottom: 20px;
      }

      .modal-content ul.l2 li {
        margin-left: 34px;
        padding-bottom: 0px;
      }

      .modal-content .material-icons {
        display: inline-flex;
        vertical-align: top;
        margin-right: 10px;
        font-size: 20px;
      }

      kbd {
        background-color: #eee;
        border-radius: 3px;
        border: 1px solid #b4b4b4;
        box-shadow: 0 1px 1px rgba(0, 0, 0, .2), 0 2px 0 0 rgba(255, 255, 255, .7) inset;
        color: #333;
        display: inline-block;
        font-size: .85em;
        font-weight: 700;
        line-height: 1;
        padding: 2px 4px;
        white-space: nowrap;
      }
    </style>
    <script>
      // Get the modal
      var modal = document.getElementById("help");

      function showHelp() {
        modal.style.display = "block";
      }

      function closeHelp() {
        modal.style.display = "none";
      }
    </script>
    <!-- Modal content -->
    <div class="modal-content">
      <span onclick="closeHelp()" class="close" id="close">&times;</span>
      <h3>How to use</h3>
      <p>When used in combination with the Node server app, new photos will be opened automatically. Alternatively you
        can drag-and-drop image files. To open a reference image for comparison <kbd>Ctrl</kbd> drag-and-drop the file.
      </p>
      <p>Additional functionality can be accessed via the right-click context menu.</p>
      <ul>
        <li>
          <span class="material-icons">file_copy</span> Copy the active photo to the target folder.
        </li>
        <li>
          <span class="material-icons">image</span> Delete the copy of the photo from the target folder.
        </li>
        <li>
          <span class="material-icons">sd_card</span> Delete the <em>original photo</em> from the camera.
          <ul class="l2">
            <li>To delete <kbd>Ctrl</kbd> + left-click. <em>Warning!</em> Use at your own risk.</li>
          </ul>
        </li>
        <li>
          <span id="grid_toggle" class="material-icons">grid_on</span> Turn the grid on or off.
        </li>
        <li>
          <span id="grid_crosshair" class="material-icons">add</span> Turn the crosshair on or off.
        </li>
        <li>
          <span id="zoom_toggle" class="material-icons">zoom_in</span> Switch to Zoom view. You can also double-click
          the image to zoom.
          <ul class="l2">
            <li>Use the mouse and scroll wheel to zoom and pan.</li>
          </ul>
        </li>
        <li>
          <span id="zoom_compare" class="material-icons">compare</span> Switch to Compare view.
        </li>
        <li>
          <span id="quick_sort" class="material-icons">category</span> Show/hide the Quick Sort buttons.
        </li>
        <li>
          <span id="file_info" class="material-icons">text_snippet</span> Show/hide the Info area.
        </li>
        <li>
          <span class="material-icons">description</span> Click to copy the filename to the clipboard.
        </li>
        <li>
          <span class="material-icons">photo_camera</span> Click to copy the source folder to the clipboard.
        </li>
        <li>
          <span class="material-icons">desktop_windows</span> Click to copy the target folder to the clipboard.
        </li>
      </ul>
      <p>To place a guide <kbd>Ctrl</kbd> + left-click the image. To clear all guides <kbd>Ctrl</kbd> + <kbd>Shift</kbd>
        +
        left-click the image.</p>
    </div>

  </div>
  <span class="debug">
    <style>
      .btn {
        position: relative;
        display: inline-block;
        box-sizing: border-box;
        border: none;
        border-radius: 4px;
        padding: 0 16px;
        min-width: 64px;
        height: 36px;
        vertical-align: middle;
        text-align: center;
        text-overflow: ellipsis;
        text-transform: uppercase;
        color: rgb(var(--pure-material-onprimary-rgb, 255, 255, 255));
        background-color: rgb(var(--pure-material-primary-rgb, 33, 150, 243));
        box-shadow: 0 3px 1px -2px rgba(0, 0, 0, 0.2), 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12);
        font-family: var(--pure-material-font, "Roboto", "Segoe UI", BlinkMacSystemFont, system-ui, -apple-system);
        font-size: 14px;
        font-weight: 500;
        line-height: 36px;
        overflow: hidden;
        outline: none;
        cursor: pointer;
        transition: box-shadow 0.2s;
      }

      .btn::-moz-focus-inner {
        border: none;
      }

      /* Overlay */
      .btn::before {
        content: "";
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: rgb(var(--pure-material-onprimary-rgb, 255, 255, 255));
        opacity: 0;
        transition: opacity 0.2s;
      }

      /* Ripple */
      .btn::after {
        content: "";
        position: absolute;
        left: 50%;
        top: 50%;
        border-radius: 50%;
        padding: 50%;
        width: 32px;
        /* Safari */
        height: 32px;
        /* Safari */
        background-color: rgb(var(--pure-material-onprimary-rgb, 255, 255, 255));
        opacity: 0;
        transform: translate(-50%, -50%) scale(1);
        transition: opacity 1s, transform 0.5s;
      }

      /* Hover, Focus */
      .btn:hover,
      .btn:focus {
        box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.2), 0 4px 5px 0 rgba(0, 0, 0, 0.14), 0 1px 10px 0 rgba(0, 0, 0, 0.12);
      }

      .btn:hover::before {
        opacity: 0.08;
      }

      .btn:focus::before {
        opacity: 0.24;
      }

      .btn:hover:focus::before {
        opacity: 0.3;
      }

      /* Active */
      .btn:active {
        box-shadow: 0 5px 5px -3px rgba(0, 0, 0, 0.2), 0 8px 10px 1px rgba(0, 0, 0, 0.14), 0 3px 14px 2px rgba(0, 0, 0, 0.12);
      }

      .btn:active::after {
        opacity: 0.32;
        transform: translate(-50%, -50%) scale(0);
        transition: transform 0s;
      }

      /* Disabled */
      .btn:disabled {
        color: rgba(var(--pure-material-onsurface-rgb, 0, 0, 0), 0.38);
        background-color: rgba(var(--pure-material-onsurface-rgb, 0, 0, 0), 0.12);
        box-shadow: none;
        cursor: initial;
      }

      .btn:disabled::before {
        opacity: 0;
      }

      .btn:disabled::after {
        opacity: 0;
      }
    </style>
    <button class="btn" onClick="toggleGrid()">Toggle Grid</button> <button class="btn" onClick="toggleZoom()">Toggle
      Zoom</button> <button class="btn" onClick="toggleCompare()">Toggle Compare</button> <button class="btn"
      onClick="toggleCrosshair()">Toggle
      Crosshair</button> <button class="btn" onClick="toggleFileinfo()">Toggle File Info</button> <button class="btn"
      onClick="toggleQuickSort()">Toggle Quick Sort</button> <button class="btn" onClick="showHelp()">Help</button>
  </span>
  <script>
    function createGrid() {
      // https://jsfiddle.net/madstop/bM5Kr/
      width = document.getElementById("container").offsetWidth + 1;
      size = Math.floor(width / 10);
      document.querySelectorAll('.gridlines').forEach(e => e.remove());
      var i,
        height = $(window).height(),
        width = $(window).width(),
        ratioW = Math.floor(width / size),
        ratioH = Math.floor(height / size);

      for (i = 0; i <= ratioW; i++) // vertical grid lines
        $('<div />').css({
          'top': 1,
          'left': i * size,
          'width': 1,
          'height': height
        })
        .addClass('gridlines')
        .insertBefore('#image');

      for (i = 0; i <= ratioH; i++) // horizontal grid lines
        $('<div />').css({
          'top': 1 + i * size,
          'left': 0,
          'width': width,
          'height': 1
        })
        .addClass('gridlines')
        .insertBefore('#image');

      $('.gridlines').show();
    }

    // ------------------------------------------------
    dblClicked = false;
    const container = document.querySelector('#container');
    container.addEventListener('dblclick', function (e) {
      dblClicked = true;
      toggleZoom();
    });




    function dropHandler(event) {
      event.preventDefault();
      // event.dataTransfer.files or event.dataTransfer.items
      /* for (var i = 0; i < event.dataTransfer.files.length; i++) {
        console.log('file[' + i + '].name = ' + event.dataTransfer.files[i].name); 
      } */
      file = event.dataTransfer.files[0];
      fileType = file.name.slice((file.name.lastIndexOf(".") - 1 >>> 0) + 2);
      if ((fileType.toLowerCase() == "jpg") || fileType.toLowerCase() == "png" || fileType.toLowerCase() == "webp") {
        let reader = new FileReader()
        reader.readAsDataURL(file)
        reader.onloadend = function () {
          let img = document.createElement('img')
          const ctrl = event.getModifierState("Control");
          if (ctrl) {
            document.getElementById("reference").src = reader.result;
            previousReference = false;
          } else {
            document.getElementById("photo").src = reader.result;
            $('#file-info').text(file.name);
          }
        }
      }
    }

    function dragOverHandler(event) {
      event.preventDefault();
    }

    function toggleQuickSort() {
      $("#triage").toggleClass("hide");
      $(".delete-copy").toggleClass("hide-menu-item");
    }


    function toggleGrid() {
      if (!(showgrid)) {
        // createGrid();
        $("#image").addClass("grid");
        document.getElementById("grid_toggle").innerText = "grid_off";
      } else {
        // document.querySelectorAll('.gridlines').forEach(e => e.remove());
        $("#image").removeClass("grid");
        document.getElementById("grid_toggle").innerText = "grid_on";
      }
      showgrid = !showgrid;
    }

    function destroyCompare() {
      console.log("kill compare");
      $('#compare').remove();
      compare = undefined;
      delete compare;
      $('#image').show();
      showCompare = false;
    }

    function createCompare() {
      console.log("create compare");
      $("<div id='compare'></div>").insertBefore($("#image"));
      var compare
      options = {
        el: '#compare', // The container, required
        line: true, // Dividing line, default true
        lineColor: "black" // Dividing line color, default rgba(0,0,0,0.5)
      }

      options.height = document.getElementById("container").offsetHeight - 1 + 'px';
      options.width = document.getElementById("container").offsetWidth - 1 + 'px';
      options.beforeImg = $('#photo').attr('src');
      options.afterImg = $('#reference').attr('src');
      compare = new SliderBar(options);
      $('#image').hide();
      showCompare = true;

      $("#compare").append(
        '<div onclick="toggleCompare()" class="close-button"><span class="material-icons">close</span></div>')
    }



    function toggleCompare() {
      console.log(showCompare);
      if (showCompare) {
        destroyCompare();
      } else {
        createCompare();
      }
    }


    var zoom;

    function activateZoom() {
      console.log("zooom on!")
      options = {
        fill: "cover",
        height: '100%',
        slider: false,
        zoomer: true
      }

      $("<div id='zoom'></div>").insertBefore($("#image"));

      $('#zoom').attr("data-zoomist-src", $('#photo').attr('src'));
      zoom = new Zoomist("#zoom", options);
      document.getElementById("zoom_toggle").innerText = "zoom_out";
      zoom.on('ready', function () {
        if (dblClicked) {
          zoom.zoom(0.1);
          dblClicked = false;
        }
      })
      document.getElementById('image').style.visibility = 'hidden';
      zoomActive = true;
    }

    function closeZoom() {
      document.getElementById('image').style.visibility = 'visible';
      zoom.reset();
      zoom.destroy();
      $('#zoom').remove();
      document.getElementById("zoom_toggle").innerText = "zoom_in";
      zoomActive = false;
    }

    function toggleZoom() {
      if (zoomActive) {
        closeZoom();
      } else {
        activateZoom();
      }
    }


    function toggleCrosshair() {
      if (showCrosshair) {
        $('.hair').addClass("hide");
        showCrosshair = false;
      } else {
        $('.hair').removeClass("hide");
        showCrosshair = true;
      }
    }

    function toggleFileinfo() {
      if (showFileinfo) {
        $('#file-info').addClass("hide");
        showFileinfo = false;
      } else {
        $('#file-info').removeClass("hide");
        showFileinfo = true;
      }
    }


    function hideMenu() {
      document.getElementById("context-menu").classList.remove("active");
    }

    window.addEventListener('load', function () {
      console.log("loaded");
      document.getElementById("container").addEventListener("contextmenu", function (event) {

        event.preventDefault();

        var contextElement = document.getElementById("context-menu");

        contextElement.addEventListener("click", hideMenu);
        contextElement.addEventListener("mouseleave", hideMenu);

        contextElement.style.top = (event.clientY - 4) + "px";
        contextElement.style.left = (event.clientX - 4) + "px";
        contextElement.classList.add("active");

      });
    });

    function resizeActions() {

    }
    window.onresize = resizeActions;

    document.addEventListener("keydown", e => {
      if (e.key === "F1") {
        showHelp();
        e.preventDefault()
      }
    })
  </script>
</body>

</html>